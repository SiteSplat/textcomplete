<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dropdown.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dropdown.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import DropdownItem from './dropdown-item';
import {createFragment} from './utils';

import extend from 'lodash.assignin';
import uniqueId from 'lodash.uniqueid';
import isFunction from 'lodash.isfunction';
import {EventEmitter} from 'events';

const DEFAULT_CLASS_NAME = 'dropdown-menu textcomplete-dropdown';

/**
 * @typedef {Object} Dropdown~Offset
 * @prop {number} [top]
 * @prop {number} [left]
 * @prop {number} [right]
 */

/**
 * @typedef {Object} Dropdown~Options
 * @prop {string} [className]
 * @prop {function|string} [footer]
 * @prop {function|string} [header]
 * @prop {number} [maxCount]
 * @prop {Object} [style]
 */

/**
 * Encapsulate a dropdown view.
 *
 * @prop {boolean} shown - Whether the #el is shown or not.
 * @prop {DropdownItem[]} items - The array of rendered dropdown items.
 * @extends EventEmitter
 */
class Dropdown extends EventEmitter {
  /**
   * @returns {HTMLUListElement}
   */
  static createElement() {
    var el = document.createElement('ul');
    el.id = uniqueId('textcomplete-dropdown-');
    extend(el.style, {
      display: 'none',
      position: 'absolute',
      zIndex: 10000,
    });
    document.body.appendChild(el);
    return el;
  }

  /**
   * @param {string} [className=DEFAULT_CLASS_NAME] - The class attribute of the el.
   * @param {function|string} [footer]
   * @param {function|string} [header]
   * @param {number} [maxCount=10]
   * @param {Object} [style] - The style of the el.
   */
  constructor({className=DEFAULT_CLASS_NAME, footer, header, maxCount=10, style}) {
    super();
    this.shown = false;
    this.items = [];
    this.footer = footer;
    this.header = header;
    this.maxCount = maxCount;
    this.el.className = className;
    if (style) {
      extend(this.el.style, style);
    }
  }

  /**
   * @private
   * @returns {HTMLUListElement}
   */
  get el() {
    this._el || (this._el = Dropdown.createElement());
    return this._el;
  }

  /**
   * @returns {number}
   */
  get length() {
    return this.items.length;
  }

  /**
   * Render the given data as dropdown items.
   *
   * @param {SearchResult[]} searchResults
   * @param {Dropdown~Offset} cursorOffset
   * @returns {this}
   */
  render(searchResults, cursorOffset) {
    var rawResults = [], dropdownItems = [];
    searchResults.forEach(searchResult => {
      rawResults.push(searchResult.data);
      if (dropdownItems.length &lt; this.maxCount) {
        dropdownItems.push(new DropdownItem(searchResult));
      }
    });
    this.clear()
        .renderEdge(rawResults, 'header')
        .append(dropdownItems)
        .renderEdge(rawResults, 'footer');
    return this.items.length > 0 ? this.setOffset(cursorOffset).show() : this.hide();
  }

  /**
   * Hide the dropdown then sweep out items.
   *
   * @returns {this}
   */
  deactivate() {
    return this.hide().clear();
  }

  /**
   * @param {DropdownItem} dropdownItem
   * @returns {this}
   * @fires Dropdown#select
   */
  select(dropdownItem) {
    /**
     * @event Dropdown#select
     * @type {object}
     * @prop {SearchResult} searchResult
     */
    this.emit('select', { searchResult: dropdownItem.searchResult });
    return this.deactivate();
  }

  /**
   * @param {function} callback
   * @returns {this}
   * @fires Dropdown#select
   */
  selectActiveItem(callback) {
    if (this.shown) {
      var activeItem = this.getActiveItem();
      if (activeItem) {
        this.select(activeItem);
        callback(activeItem);
      }
    }
    return this;
  }

  /**
   * @param {function} callback
   * @returns {this}
   */
  up(callback) {
    return this.moveActiveItem('prev', callback);
  }

  /**
   * @param {function} callback
   * @returns {this}
   */
  down(callback) {
    return this.moveActiveItem('next', callback);
  }

  /**
   * Add items to dropdown.
   *
   * @private
   * @param {DropdownItem[]} items
   * @returns {this};
   */
  append(items) {
    var fragment = document.createDocumentFragment();
    items.forEach((item) => {
      this.items.push(item);
      item.appended(this);
      fragment.appendChild(item.el);
    });
    this.el.appendChild(fragment);
    return this;
  }

  /**
   * @private
   * @param {Dropdown~Offset} cursorOffset
   * @returns {this}
   */
  setOffset(cursorOffset) {
    ['top', 'right', 'bottom', 'left'].forEach(name => {
      if (cursorOffset.hasOwnProperty(name)) {
        this.el.style[name] = `${cursorOffset[name]}px`;
      }
    });
    return this;
  }

  /**
   * Show the element.
   *
   * @private
   * @returns {this}
   * @fires Dropdown#show
   * @fires Dropdown#shown
   * @fires Dropdown#rendered
   */
  show() {
    if (!this.shown) {
      /** @event Dropdown#show */
      this.emit('show');
      this.el.style.display = 'block';
      this.shown = true;
      /** @event Dropdown#shown */
      this.emit('shown');
    }
    /** @event Dropdown#rendered */
    this.emit('rendered');
    return this;
  }

  /**
   * Hide the element.
   *
   * @private
   * @returns {this}
   * @fires Dropdown#hide
   * @fires Dropdown#hidden
   */
  hide() {
    if (this.shown) {
      /** @event Dropdown#hide */
      this.emit('hide');
      this.el.style.display = 'none';
      this.shown = false;
      /** @event Dropdown#hidden */
      this.emit('hidden');
    }
    return this;
  }

  /**
   * Clear search results.
   *
   * @private
   * @returns {this}
   */
  clear() {
    this.el.innerHTML = '';
    this.items.forEach((item) => { item.finalize(); });
    this.items = [];
    return this;
  }

  /**
   * Retrieve the active item.
   *
   * @private
   * @returns {DropdownItem|undefined}
   */
  getActiveItem() {
    return this.items.find((item) => { return item.active; });
  }

  /**
   * @private
   * @param {string} name
   * @param {function} callback
   * @returns {this}
   */
  moveActiveItem(name, callback) {
    if (this.shown) {
      let activeItem = this.getActiveItem();
      if (activeItem) {
        activeItem.deactivate();
        callback(activeItem[name].activate());
      }
    }
    return this;
  }

  /**
   * @private
   * @param {object[]} rawResults - What callbacked by search function.
   * @param {string} type - 'header' or 'footer'.
   * @returns {this}
   */
  renderEdge(rawResults, type) {
    var source = this[type];
    if (source) {
      let content = isFunction(source) ? source(rawResults) : source;
      let fragment = createFragment(`&lt;li class="textcomplete-${type}">${content}&lt;/li>`);
      this.el.appendChild(fragment);
    }
    return this;
  }
}

export default Dropdown;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Completer.html">Completer</a></li><li><a href="Dropdown.html">Dropdown</a></li><li><a href="DropdownItem.html">DropdownItem</a></li><li><a href="Editor.html">Editor</a></li><li><a href="Query.html">Query</a></li><li><a href="SearchResult.html">SearchResult</a></li><li><a href="Strategy.html">Strategy</a></li><li><a href="Textarea.html">Textarea</a></li><li><a href="Textcomplete.html">Textcomplete</a></li></ul><h3>Events</h3><ul><li><a href="Completer.html#event:hit">hit</a></li><li><a href="Dropdown.html#event:hidden">hidden</a></li><li><a href="Dropdown.html#event:hide">hide</a></li><li><a href="Dropdown.html#event:rendered">rendered</a></li><li><a href="Dropdown.html#event:select">select</a></li><li><a href="Dropdown.html#event:show">show</a></li><li><a href="Dropdown.html#event:shown">shown</a></li><li><a href="Editor.html#event:blur">blur</a></li><li><a href="Editor.html#event:change">change</a></li><li><a href="Editor.html#event:move">move</a></li><li><a href="Textarea.html#event:blur">blur</a></li><li><a href="Textarea.html#event:change">change</a></li><li><a href="Textarea.html#event:move">move</a></li><li><a href="Textcomplete.html#event:hidden">hidden</a></li><li><a href="Textcomplete.html#event:hide">hide</a></li><li><a href="Textcomplete.html#event:rendered">rendered</a></li><li><a href="Textcomplete.html#event:show">show</a></li><li><a href="Textcomplete.html#event:shown">shown</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-development.html">Development</a></li><li><a href="tutorial-getting-started.html">Getting Started</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createFragment">createFragment</a></li><li><a href="global.html#lock">lock</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Mar 02 2016 13:32:05 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
